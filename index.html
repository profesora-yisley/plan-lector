<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis de Cumplimiento - Plan Lector</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(to bottom right, #eff6ff, #e0e7ff);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: #6b7280;
            margin-bottom: 1.5rem;
            font-size: 1rem;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 4px;
        }

        .info-box h3 {
            color: #1e3a8a;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .info-box ul {
            list-style: none;
            color: #1e40af;
            font-size: 0.875rem;
        }

        .info-box li {
            margin: 0.25rem 0;
        }

        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }

        #searchInput {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        #searchInput:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f3f4f6;
        }

        th {
            padding: 1rem 1.5rem;
            text-align: left;
            font-size: 0.75rem;
            font-weight: 600;
            color: #374151;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        th:hover {
            background: #e5e7eb;
        }

        th.center {
            text-align: center;
        }

        .sort-indicator {
            display: inline-block;
            margin-left: 0.5rem;
            font-size: 0.875rem;
        }

        tbody tr {
            border-bottom: 1px solid #e5e7eb;
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        td {
            padding: 1rem 1.5rem;
            font-size: 0.875rem;
        }

        td.center {
            text-align: center;
        }

        .teacher-name {
            font-weight: 600;
            color: #111827;
        }

        .text-green {
            color: #059669;
            font-weight: 600;
        }

        .text-red {
            color: #dc2626;
            font-weight: 600;
        }

        .text-blue {
            color: #2563eb;
            font-weight: 600;
        }

        .text-yellow {
            color: #d97706;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            padding: 1rem;
            border-radius: 8px;
            border: 2px solid;
        }

        .stat-card.green {
            background: #f0fdf4;
            border-color: #86efac;
        }

        .stat-card.blue {
            background: #dbeafe;
            border-color: #93c5fd;
        }

        .stat-card.yellow {
            background: #fef3c7;
            border-color: #fcd34d;
        }

        .stat-card.red {
            background: #fee2e2;
            border-color: #fca5a5;
        }

        .stat-card h4 {
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .stat-card.green h4 {
            color: #166534;
        }

        .stat-card.blue h4 {
            color: #1e40af;
        }

        .stat-card.yellow h4 {
            color: #92400e;
        }

        .stat-card.red h4 {
            color: #991b1b;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-card.green .stat-value {
            color: #059669;
        }

        .stat-card.blue .stat-value {
            color: #2563eb;
        }

        .stat-card.yellow .stat-value {
            color: #d97706;
        }

        .stat-card.red .stat-value {
            color: #dc2626;
        }

        .note {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 0.875rem;
            color: #4b5563;
        }

        .note strong {
            color: #1f2937;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .title-container {
            flex: 1;
        }

        .download-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background-color: #2563eb;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
            text-decoration: none;
            height: fit-content;
            margin-left: 1rem;
        }

        .download-btn:hover {
            background-color: #1d4ed8;
        }

        .download-btn svg {
            width: 16px;
            height: 16px;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .card {
                padding: 1rem;
            }

            th, td {
                padding: 0.5rem;
                font-size: 0.75rem;
            }

            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .download-btn {
                width: 100%;
                justify-content: center;
                margin-left: 0;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header-container">
                <div class="title-container">
                    <h1>Análisis de Cumplimiento - Plan Lector</h1>
                    <p class="subtitle">Período: 2 de junio - 27 de noviembre de 2025</p>
                </div>
                <button id="downloadPdf" class="download-btn">
                    <span>Descargar PDF</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
            </div>
            
            <div class="info-box">
                <h3>Información del Análisis</h3>
                <ul>
                    <li>• Total de profesores analizados: 33</li>
                    <li>• Períodos evaluados: Junio-Septiembre (12:00), Julio-Octubre (8:30), Agosto-Noviembre (10:15)</li>
                    <li>• Nota: Los IV medio no se consideran en noviembre (licenciados)</li>
                </ul>
            </div>

            <div class="search-container">
                <svg class="search-icon" width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                <input type="text" id="searchInput" placeholder="Buscar profesor...">
            </div>

            <div class="table-container">
                <table id="dataTable">
                    <thead>
                        <tr>
                            <th data-column="nombre">
                                Nombre del Docente
                                <span class="sort-indicator"></span>
                            </th>
                            <th data-column="totalDias" class="center">
                                Total Días
                                <span class="sort-indicator"></span>
                            </th>
                            <th data-column="cumplidos" class="center">
                                Días Cumplidos
                                <span class="sort-indicator"></span>
                            </th>
                            <th data-column="incumplidos" class="center">
                                Días Incumplidos
                                <span class="sort-indicator"></span>
                            </th>
                            <th data-column="porcentaje" class="center">
                                % Cumplimiento
                                <span class="sort-indicator"></span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>

            <div class="stats-grid">
                <div class="stat-card green">
                    <h4>Excelente (mayor igual 90%)</h4>
                    <div class="stat-value" id="statExcelente">0</div>
                </div>
                <div class="stat-card blue">
                    <h4>Bueno (80-89%)</h4>
                    <div class="stat-value" id="statBueno">0</div>
                </div>
                <div class="stat-card yellow">
                    <h4>Regular (70-79%)</h4>
                    <div class="stat-value" id="statRegular">0</div>
                </div>
                <div class="stat-card red">
                    <h4>Deficiente (menor 70%)</h4>
                    <div class="stat-value" id="statDeficiente">0</div>
                </div>
            </div>

            <div class="note">
                <p><strong>Nota metodológica:</strong> El análisis considera únicamente los días donde cada profesor tenía asignada la responsabilidad de monitorear el Plan Lector según su horario. Los días compartidos se contabilizan para todos los profesores asignados.</p>
            </div>
        </div>
    </div>

    <script>
        const data = [
            { nombre: "Alex Briones", totalDias: 87, cumplidos: 79, incumplidos: 8, porcentaje: 90.80 },
            { nombre: "Aníbal Rubilar", totalDias: 58, cumplidos: 45, incumplidos: 13, porcentaje: 77.59 },
            { nombre: "Carolina Asencio", totalDias: 42, cumplidos: 31, incumplidos: 11, porcentaje: 73.81 },
            { nombre: "Claudia Fernández", totalDias: 105, cumplidos: 84, incumplidos: 21, porcentaje: 80.00 },
            { nombre: "Cyntia Lagos", totalDias: 86, cumplidos: 73, incumplidos: 13, porcentaje: 84.88 },
            { nombre: "Daniela Garrido", totalDias: 63, cumplidos: 48, incumplidos: 15, porcentaje: 76.19 },
            { nombre: "Daniela Huaiquimil", totalDias: 142, cumplidos: 108, incumplidos: 34, porcentaje: 76.06 },
            { nombre: "Daniella Farías", totalDias: 78, cumplidos: 65, incumplidos: 13, porcentaje: 83.33 },
            { nombre: "David Farías", totalDias: 18, cumplidos: 13, incumplidos: 5, porcentaje: 72.22 },
            { nombre: "Estefanía Yáñez", totalDias: 62, cumplidos: 48, incumplidos: 14, porcentaje: 77.42 },
            { nombre: "Eunice Caifal", totalDias: 99, cumplidos: 86, incumplidos: 13, porcentaje: 86.87 },
            { nombre: "Gabriela Quintricón", totalDias: 141, cumplidos: 111, incumplidos: 30, porcentaje: 78.72 },
            { nombre: "Gerardo Astete", totalDias: 76, cumplidos: 67, incumplidos: 9, porcentaje: 88.16 },
            { nombre: "Gloria Poblete", totalDias: 19, cumplidos: 12, incumplidos: 7, porcentaje: 63.16 },
            { nombre: "Ismael Ruiz", totalDias: 21, cumplidos: 19, incumplidos: 2, porcentaje: 90.48 },
            { nombre: "Juan Carlos Alfaro", totalDias: 151, cumplidos: 123, incumplidos: 28, porcentaje: 81.46 },
            { nombre: "Leticia Huaiqui", totalDias: 143, cumplidos: 116, incumplidos: 27, porcentaje: 81.12 },
            { nombre: "Luis Solano", totalDias: 82, cumplidos: 65, incumplidos: 17, porcentaje: 79.27 },
            { nombre: "Mabel Silva", totalDias: 89, cumplidos: 75, incumplidos: 14, porcentaje: 84.27 },
            { nombre: "Margot Arzola", totalDias: 82, cumplidos: 64, incumplidos: 18, porcentaje: 78.05 },
            { nombre: "María José G.", totalDias: 132, cumplidos: 107, incumplidos: 25, porcentaje: 81.06 },
            { nombre: "María José Paredes", totalDias: 74, cumplidos: 64, incumplidos: 10, porcentaje: 86.49 },
            { nombre: "Nancy Manquian", totalDias: 86, cumplidos: 68, incumplidos: 18, porcentaje: 79.07 },
            { nombre: "Nataly Soto", totalDias: 21, cumplidos: 20, incumplidos: 1, porcentaje: 95.24 },
            { nombre: "Nicols Peña", totalDias: 108, cumplidos: 89, incumplidos: 19, porcentaje: 82.41 },
            { nombre: "Nolfa García", totalDias: 116, cumplidos: 93, incumplidos: 23, porcentaje: 80.17 },
            { nombre: "Norma Cayuqueo", totalDias: 118, cumplidos: 97, incumplidos: 21, porcentaje: 82.20 },
            { nombre: "Pablo Marifil", totalDias: 77, cumplidos: 64, incumplidos: 13, porcentaje: 83.12 },
            { nombre: "Patricia Soto", totalDias: 98, cumplidos: 79, incumplidos: 19, porcentaje: 80.61 },
            { nombre: "Rodrigo Zuñiga", totalDias: 40, cumplidos: 33, incumplidos: 7, porcentaje: 82.50 },
            { nombre: "Tamara Cárdenas", totalDias: 5, cumplidos: 5, incumplidos: 0, porcentaje: 100.00 },
            { nombre: "Valentina León", totalDias: 41, cumplidos: 27, incumplidos: 14, porcentaje: 65.85 },
            { nombre: "Yisley Krause", totalDias: 27, cumplidos: 25, incumplidos: 2, porcentaje: 92.59 }
        ];

        let currentSort = { column: 'nombre', direction: 'asc' };
        let filteredData = [...data];

        function getColorClass(porcentaje) {
            if (porcentaje >= 90) return 'text-green';
            if (porcentaje >= 80) return 'text-blue';
            if (porcentaje >= 70) return 'text-yellow';
            return 'text-red';
        }

        function renderTable(dataToRender) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            dataToRender.forEach(teacher => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="teacher-name">${teacher.nombre}</td>
                    <td class="center">${teacher.totalDias}</td>
                    <td class="center text-green">${teacher.cumplidos}</td>
                    <td class="center text-red">${teacher.incumplidos}</td>
                    <td class="center ${getColorClass(teacher.porcentaje)}">${teacher.porcentaje.toFixed(2)}%</td>
                `;
                tbody.appendChild(row);
            });

            updateStats(dataToRender);
        }

        function updateStats(dataToRender) {
            const excelente = dataToRender.filter(t => t.porcentaje >= 90).length;
            const bueno = dataToRender.filter(t => t.porcentaje >= 80 && t.porcentaje < 90).length;
            const regular = dataToRender.filter(t => t.porcentaje >= 70 && t.porcentaje < 80).length;
            const deficiente = dataToRender.filter(t => t.porcentaje < 70).length;

            document.getElementById('statExcelente').textContent = excelente;
            document.getElementById('statBueno').textContent = bueno;
            document.getElementById('statRegular').textContent = regular;
            document.getElementById('statDeficiente').textContent = deficiente;
        }

        function sortData(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }

            filteredData.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];

                if (column === 'nombre') {
                    return currentSort.direction === 'asc' 
                        ? aVal.localeCompare(bVal)
                        : bVal.localeCompare(aVal);
                } else {
                    return currentSort.direction === 'asc' 
                        ? aVal - bVal
                        : bVal - aVal;
                }
            });

            updateSortIndicators();
            renderTable(filteredData);
        }

        function updateSortIndicators() {
            document.querySelectorAll('th .sort-indicator').forEach(indicator => {
                indicator.textContent = '';
            });

            const activeHeader = document.querySelector(`th[data-column="${currentSort.column}"] .sort-indicator`);
            if (activeHeader) {
                activeHeader.textContent = currentSort.direction === 'asc' ? '▲' : '▼';
            }
        }

        function filterData(searchTerm) {
            filteredData = data.filter(teacher =>
                teacher.nombre.toLowerCase().includes(searchTerm.toLowerCase())
            );

            sortData(currentSort.column);
        }

        // Función para generar PDF
        document.getElementById('downloadPdf').addEventListener('click', async function() {
            const btn = this;
            const originalText = btn.innerHTML;
            btn.innerHTML = 'Generando PDF...';
            btn.disabled = true;

            try {
                // Obtener el elemento a convertir
                const element = document.querySelector('.card');
                
                // Configuración de html2pdf
                const opt = {
                    margin: [10, 10, 10, 10],
                    filename: 'analisis_plan_lector.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { 
                        scale: 2,
                        useCORS: true,
                        logging: false,
                        letterRendering: true,
                        scrollY: 0
                    },
                    jsPDF: { 
                        unit: 'mm',
                        format: 'a4',
                        orientation: 'portrait'
                    }
                };
                
                // Generar el PDF
                await html2pdf().set(opt).from(element).save();
                
            } catch (error) {
                console.error('Error al generar el PDF:', error);
                alert('Error al generar el PDF. Por favor, inténtalo de nuevo.');
            } finally {
                // Restaurar el botón en cualquier caso
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        });

        document.querySelectorAll('th[data-column]').forEach(header => {
            header.addEventListener('click', () => {
                sortData(header.dataset.column);
            });
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            filterData(e.target.value);
        });

        renderTable(data);
        updateSortIndicators();
    </script>
</body>
</html>
